<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>接駁車查詢系統</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
select { margin: 5px; padding: 5px; }
.card {
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 10px;
  margin: 10px 0;
  box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
}
</style>
</head>
<body>

<h2>接駁車班次查詢</h2>
<label>去程/回程：</label>
<select id="directionSelect"><option value="">請選擇</option></select>

<label>日期：</label>
<select id="dateSelect"><option value="">請選擇</option></select>

<label>站點：</label>
<select id="stationSelect"><option value="">請選擇</option></select>

<div id="results"></div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/1ndM-i4cVB96-DbK6gW-YSKktEPu6-T0cmZiCldbbRz0/gviz/tq?tqx=out:csv&sheet=可預約班次(web)";

let allData = [];

fetch(sheetUrl)
  .then(res => res.text())
  .then(csv => {
    const rows = csv.trim().split("\n").map(r => r.split(","));
    const headers = rows[0];
    allData = rows.slice(1).map(row => {
      let obj = {};
      headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim());
      return obj;
    });
    initDirectionSelect();
  });

function initDirectionSelect() {
  const directions = [...new Set(allData.map(r => r["去程 / 回程"]).filter(Boolean))];
  const select = document.getElementById("directionSelect");
  directions.forEach(d => {
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = d;
    select.appendChild(opt);
  });
}

document.getElementById("directionSelect").addEventListener("change", function() {
  const selectedDirection = this.value;
  const filteredDates = [...new Set(allData
    .filter(r => r["去程 / 回程"] === selectedDirection)
    .map(r => r["日期"])
    .filter(Boolean))];
  const dateSelect = document.getElementById("dateSelect");
  dateSelect.innerHTML = '<option value="">請選擇</option>';
  filteredDates.forEach(date => {
    const opt = document.createElement("option");
    opt.value = date;
    opt.textContent = date;
    dateSelect.appendChild(opt);
  });
  document.getElementById("stationSelect").innerHTML = '<option value="">請選擇</option>';
  document.getElementById("results").innerHTML = '';
});

document.getElementById("dateSelect").addEventListener("change", function() {
  const selectedDirection = document.getElementById("directionSelect").value;
  const selectedDate = this.value;
  const filteredStations = [...new Set(allData
    .filter(r => r["去程 / 回程"] === selectedDirection && r["日期"] === selectedDate)
    .map(r => r["站點"])
    .filter(Boolean))];
  const stationSelect = document.getElementById("stationSelect");
  stationSelect.innerHTML = '<option value="">請選擇</option>';
  filteredStations.forEach(station => {
    const opt = document.createElement("option");
    opt.value = station;
    opt.textContent = station;
    stationSelect.appendChild(opt);
  });
  document.getElementById("results").innerHTML = '';
});

document.getElementById("stationSelect").addEventListener("change", function() {
  const selectedDirection = document.getElementById("directionSelect").value;
  const selectedDate = document.getElementById("dateSelect").value;
  const selectedStation = this.value;

  const filteredTrips = allData.filter(row =>
    row["去程 / 回程"] === selectedDirection &&
    row["日期"] === selectedDate &&
    row["站點"] === selectedStation
  );

  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = '';
  filteredTrips.forEach(trip => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<b>${trip["班次"]}</b> - ${trip["可預約人數"]}`;
    resultsDiv.appendChild(card);
  });
});
</script>

</body>
</html>
