<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¥é§è»Šé ç´„ç³»çµ±</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #fff6ef;
    margin: 0;
    padding: 20px;
  }

  h2 {
    text-align: center;
    color: #ff7f2a;
    margin-bottom: 5px;
  }
  h4 {
    text-align: center;
    color: #555;
    margin-top: 0;
    font-weight: normal;
  }

  .step {
    display: none;
    margin-top: 20px;
    text-align: center;
  }
  .active {
    display: block;
  }

  .button-group, .card-group {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  /* ç¬¬ä¸€é æŒ‰éˆ• - æ©˜åº•ç™½å­— */
  .btn-orange {
    background-color: #ff7f2a;
    color: white;
    padding: 15px 30px;
    font-size: 18px;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .btn-orange:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  /* å…¶ä»–æ­¥é©Ÿå¡ç‰‡ - ç™½åº•æ©˜å­— */
  .card {
    background-color: white;
    color: #ff7f2a;
    border-radius: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
    width: 220px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    white-space: pre-line; /* å…è¨±æ›è¡Œ */
  }
  .card:hover {
    transform: scale(1.03);
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
  }
  .card h3 {
    margin: 0 0 10px;
    color: #ff7f2a;
  }
  .card p {
    margin: 5px 0;
    color: #555;
  }

  .back-btn {
    margin-top: 20px;
    background-color: #ccc;
    color: #333;
    padding: 10px 20px;
    border-radius: 15px;
    border: none;
    cursor: pointer;
  }
  .back-btn:hover {
    background-color: #bbb;
  }

  /* Loading å‹•ç•« */
  #loading {
    display: none;
    text-align: center;
    margin-top: 50px;
    color: #ff7f2a;
    font-size: 18px;
  }
  .loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #ff7f2a;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    animation: spin 1s linear infinite;
    margin: 10px auto;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</head>
<body>

<!-- Step 1: å»ç¨‹ / å›ç¨‹ -->
<div id="step1" class="step active">
  <div class="button-group">
    <button class="btn-orange" onclick="selectDirection('å»ç¨‹')">ğŸš— å»ç¨‹<br>Outbound</button>
    <button class="btn-orange" onclick="selectDirection('å›ç¨‹')">ğŸ  å›ç¨‹<br>Return</button>
  </div>
</div>

<!-- Step 2: æ—¥æœŸ -->
<div id="step2" class="step">
  <h2 id="directionTitle"></h2>
  <h4 id="directionSubtitle"></h4>
  <div class="card-group" id="dateCards"></div>
  <button class="back-btn" onclick="goBack(1)">â† è¿”å› Back</button>
</div>

<!-- Step 3: ç­æ¬¡ -->
<div id="step3" class="step">
  <h2 id="dateTitle"></h2>
  <h4 id="dateSubtitle"></h4>
  <div class="card-group" id="timeCards"></div>
  <button class="back-btn" onclick="goBack(2)">â† è¿”å› Back</button>
</div>

<!-- Step 4: æœ€çµ‚å¯é ç´„ -->
<div id="step4" class="step">
  <h2 id="stationTitle"></h2>
  <h4 id="stationSubtitle"></h4>
  <div class="card-group" id="resultCards"></div>
  <button class="back-btn" onclick="goBack(3)">â† è¿”å› Back</button>
</div>

<!-- Loading -->
<div id="loading">
  <div class="loader"></div>
  <div>è³‡æ–™è®€å–ä¸­ / Loading data...</div>
</div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbwSdpog6sJH9OerAUj9W7BesGHj4y2X9Jc0t1CBDM6iD9kzQYFn4iHc3mJUuO9q87Ke/exec";
let allData = [];
let selectedDirection = '';
let selectedDate = '';

async function fetchData() {
  document.getElementById('loading').style.display = 'block';
  const res = await fetch(SHEET_URL);
  const data = await res.json();
  document.getElementById('loading').style.display = 'none';
  return data.map(row => ({
    ...row,
    "æ—¥æœŸ": String(row["æ—¥æœŸ"]), // ä¿æŒç´”æ–‡å­—
    "ç«™é»": row["ç«™é»"].replace(" ", "\n") // ä¸­è‹±æ–‡æ›è¡Œ
  }));
}

function showStep(step) {
  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  document.getElementById('step'+step).classList.add('active');
}

function selectDirection(direction) {
  selectedDirection = direction;
  document.getElementById('directionTitle').innerText = direction + (direction==="å»ç¨‹" ? " Outbound" : " Return (To Hotel)");
  document.getElementById('directionSubtitle').innerText = "è«‹é¸æ“‡æ—¥æœŸ / Please select a date";
  const dates = [...new Set(allData.filter(d=>d["å»ç¨‹ / å›ç¨‹"]===direction).map(d=>d["æ—¥æœŸ"]))];
  const dateCards = document.getElementById('dateCards');
  dateCards.innerHTML = '';
  dates.forEach(date => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<h3>${date}</h3>`;
    card.onclick = () => selectDate(date);
    dateCards.appendChild(card);
  });
  showStep(2);
}

function selectDate(date) {
  selectedDate = date;
  document.getElementById('dateTitle').innerText = selectedDirection + " " + date;
  document.getElementById('dateSubtitle').innerText = "ä¸Šè»Šé» Boarding: (è«‹é¸æ“‡ / Please select)";
  const stations = [...new Set(allData.filter(d=>d["å»ç¨‹ / å›ç¨‹"]===selectedDirection && d["æ—¥æœŸ"]===date).map(d=>d["ç«™é»"]))];
  const timeCards = document.getElementById('timeCards');
  timeCards.innerHTML = '';
  stations.forEach(st => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<h3>${st}</h3>`;
    card.onclick = () => selectStation(st);
    timeCards.appendChild(card);
  });
  showStep(3);
}

function selectStation(station) {
  document.getElementById('stationTitle').innerText = selectedDirection + " " + selectedDate;
  document.getElementById('stationSubtitle').innerText = station;
  const results = allData.filter(d=>d["å»ç¨‹ / å›ç¨‹"]===selectedDirection && d["æ—¥æœŸ"]===selectedDate && d["ç«™é»"]===station);
  const resultCards = document.getElementById('resultCards');
  resultCards.innerHTML = '';
  results.forEach(r => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<h3>${r["ç­æ¬¡"]}</h3><p>${r["å¯é ç´„äººæ•¸"]}</p>`;
    resultCards.appendChild(card);
  });
  showStep(4);
}

function goBack(step) {
  showStep(step);
}

(async () => {
  allData = await fetchData();
})();
</script>
</body>
</html>
